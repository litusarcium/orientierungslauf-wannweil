<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR-Abenteuer</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        #scanner-container { display: none; margin: auto; width: 300px; }
        .location { padding: 10px; margin: 10px; border: 2px solid black; border-radius: 5px; background-color: #f4f4f4; display: flex; justify-content: space-between; max-width: 300px; margin: auto; }
        .reached { color: green; font-weight: bold; }
        .not-reached { color: red; font-weight: bold; }
    </style>
</head>
<body>

    <h1>QR-Abenteuer</h1>
    <p>Scanne die QR-Codes, um alle Punkte zu erreichen!</p>

    <button onclick="startScanner()">üì∑ Scanner starten</button>
    <button onclick="stopScanner()">‚õî Scanner stoppen</button>
    
    <div id="scanner-container">
        <div id="qr-reader"></div>
    </div>

    <h2>Deine erreichten Orte:</h2>
    <div id="locations"></div>

    <button onclick="resetProgress()">üîÑ Fortschritt zur√ºcksetzen</button>

    <script>
        let scannerRunning = false;
        const allLocations = { "burg": "üè∞ Burg", "schloss": "üèØ Schloss", "museum": "üèõÔ∏è Museum", "park": "üå≥ Park" };
        let reachedLocations = JSON.parse(localStorage.getItem("qrProgress")) || [];
        const scannerContainer = document.getElementById("scanner-container");

        function startScanner() {
            if (scannerRunning) return;
            scannerContainer.style.display = "block";
            scannerRunning = true;

            const qrScanner = new Html5Qrcode("qr-reader");
            qrScanner.start(
                { facingMode: "environment" },
                { fps: 10, qrbox: 250 },
                (decodedText) => {
                    if (!reachedLocations.includes(decodedText) && allLocations[decodedText]) {
                        reachedLocations.push(decodedText);
                        localStorage.setItem("qrProgress", JSON.stringify(reachedLocations));
                        updateLocations();
                        alert("‚úÖ Erfolgreich gescannt: " + allLocations[decodedText]);
                    }
                },
                (errorMessage) => { console.warn("Scan-Fehler:", errorMessage); }
            ).catch(err => console.error("Scanner-Fehler:", err));
        }

        function stopScanner() {
            scannerContainer.style.display = "none";
            scannerRunning = false;
        }

        function updateLocations() {
            const container = document.getElementById("locations");
            container.innerHTML = "";
            for (const key in allLocations) {
                const div = document.createElement("div");
                div.className = "location";
                div.innerHTML = `<span>${allLocations[key]}</span> <span class="${reachedLocations.includes(key) ? 'reached' : 'not-reached'}">${reachedLocations.includes(key) ? '‚úÖ Erreicht!' : '‚ùå Noch nicht erreicht'}</span>`;
                container.appendChild(div);
            }
        }

        function resetProgress() {
            localStorage.removeItem("qrProgress");
            reachedLocations = [];
            updateLocations();
        }

        updateLocations();
    </script>

</body>
</html>
